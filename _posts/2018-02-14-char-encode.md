---
layout: post
title: 【转】网页编码就是那点事
date: 2018-02-14
math: true
---

> [于江水](http://yujiangshui.com/about/)（昵称潜行者m）2012 年的博文[《网页编码就是那点事》][encode]，把编码的来龙去脉梳理的清晰有趣，获益匪浅。转载原文如下：

很久很久以前，有一群人，他们决定用 8 个可以开合的晶体管来组合成不同的状态，以表示世界上的万物，他们把这称为**字节**。再后来，他们又做了一些可以处理这些字节的机器，机器开动了，可以用字节来组合出很多状态，状态开始变来变去，他们就把这机器称为“计算机”。

开始计算机只在美国用。8 位的字节一共可以组合出 256($$2^8$$)种不同的状态。他们把其中的编号从 0 开始的 32 种状态分别规定了特殊的用途，一旦终端、打印机遇上约定好的这些字节被传过来时，就要做一些约定的动作。遇上 `0x10`, 终端就换行，遇上 `0x07`, 终端就向人们嘟嘟叫，假如遇上 `0x1b`, 打印机就打印反白的字，或者终端就用彩色显示字母。他们看到这样很好，于是就把这些 `0x20` 以下的字节状态称为**控制码**。

他们又把所有的空格、标点符号、数字、大小写字母分别用连续的字节状态表示，一直编到了第 127 号，这样计算机就可以用不同字节来存储英语的文字了。大家看到这样，都感觉很好，于是大家都把这个方案叫做 ANSI 的 **ASCII 编码**（`American Standard Code for Information Interchange`，美国信息互换标准代码）。当时世界上所有的计算机都用同样的 ASCII 方案来保存英文文字。

后来计算机发展越来越广泛，世界各国为了可以在计算机保存他们的文字，他们决定采用 127 号之后的空位来表示这些新的字母、符号，还加入了很多画表格时需要用下到的横线、竖线、交叉等形状，一直把序号编到了最后一个状态 255。从 128 到 255 这一页的字符集被称**扩展字符集**。但是原有的编号方法，已经再也放不下更多的编码。

等中国人得到计算机时，已经没有可以利用的字节状态来表示汉字，况且有 6000 多个常用汉字需要保存呢。于是国人就自主研发，把那些 127 号之后的奇异符号们直接取消掉。规定：一个小于 127 的字符的意义与原来相同，但两个大于 127 的字符连在一起时，就表示一个汉字，前面的一个字节（他称之为**高字节**）从 `0xA1` 用到 `0xF7`，后面一个字节（**低字节**）从 `0xA1` 到 `0xFE`，这样我们就可以组合出大约 7000 多个简体汉字了。在这些编码里，我们还把数学符号、罗马希腊的字母、日文的假名们都编进去了，连在 ASCII 里本来就有的数字、标点、字母都统统重新编了两个字节长的编码，这就是常说的**全角**字符，而原来在 127 号以下的那些就叫**半角**字符了。

中国人民看到这样很不错，于是就把这种汉字方案叫做 **GB2312**。GB2312 是对 ASCII 的中文扩展。

但是中国的汉字太多了，后来还是不够用，于是干脆不再要求低字节一定是 127 号之后的内码，只要第一个字节是大于 127 就固定表示这是一个汉字的开始，不管后面跟的是不是扩展字符集里的内容。结果扩展之后的编码方案被称为 **GBK 标准**，GBK 包括了 GB2312 的所有内容，同时又增加了近 20000 个新的汉字（包括繁体字）和符号。后来少数民族也要用电脑了，于是我们再扩展，又加了几千个新的少数民族的字，GBK 扩成了 **GB18030**。从此之后，中华民族的文化就可以在计算机时代中传承了。

因为当时各个国家都像中国这样搞出一套自己的编码标准，结果互相之间谁也不懂谁的编码，谁也不支持别人的编码。当时的中国人想让电脑显示汉字，就必须装上一个”汉字系统”，专门用来处理汉字的显示、输入的问题，装错了字符系统，显示就会乱了套。这怎么办？就在这时，一个叫 ISO （国际标谁化组织）的国际组织决定着手解决这个问题。他们采用的方法很简单：废了所有的地区性编码方案，重新搞一个包括了地球上所有文化、所有字母和符号的编码！他们打算叫它 `Universal Multiple-Octet Coded Character Set`，简称 `UCS`, 俗称 **UNICODE**。

UNICODE 开始制订时，计算机的存储器容量极大地发展了，空间再也不成为问题了。于是 ISO 就直接规定必须用两个字节，也就是 16 位来统一表示所有的字符，对于 ASCII 里的那些“半角”字符，UNICODE 保持其原编码不变，只是将其长度由原来的 8 位扩展为 16 位，而其他文化和语言的字符则全部重新统一编码。由于“半角”英文符号只需要用到低 8 位，所以其高 8 位永远是 0，因此这种大气的方案在保存英文文本时会多浪费一倍的空间。

但是，UNICODE 在制订时没有考虑与任何一种现有的编码方案保持兼容，这使得 GBK 与 UNICODE 在汉字的内码编排上完全是不一样的，没有一种简单的算术方法可以把文本内容从 UNICODE 编码和另一种编码进行转换，这种转换必须通过查表来进行。UNICODE 是用两个字节来表示为一个字符，他总共可以组合出 65535 不同的字符，这大概已经可以覆盖世界上所有文化的符号。

UNICODE 来到时，一起到来的还有计算机网络的兴起，UNICODE 如何在网络上传输也是一个必须考虑的问题，于是面向传输的众多 **UTF**（`UCS Transfer Format`）标准出现了，顾名思义，UTF8 就是每次 8 个位传输数据，而 UTF16 就是每次 16 个位，只不过为了传输时的可靠性，从 UNICODE 到 UTF 时并不是直接的对应，而是要过一些算法和规则来转换。

看完这些，相信你对于这几个编码关系等，了解的比较清楚了吧。我再来简单的总结一下：

- 中国人民通过对 ASCII 编码的中文扩充改造，产生了 GB2312 编码，可以表示 6000 多个常用汉字。
- 汉字实在是太多了，包括繁体和各种字符，于是产生了 GBK 编码，它包括了 GB2312 中的编码，同时扩充了很多。
- 中国是个多民族国家，各个民族几乎都有自己独立的语言系统，为了表示那些字符，继续把 GBK 编码扩充为 GB18030 编码。
- 每个国家都像中国一样，把自己的语言编码，于是出现了各种各样的编码，如果你不安装相应的编码，就无法解释相应编码想表达的内容。
- 终于，有个叫 ISO 的组织看不下去了。他们一起创造了一种编码 UNICODE ，这种编码非常大，大到可以容纳世界上任何一个文字和标志。所以只要电脑上有 UNICODE 这种编码系统，无论是全球哪种文字，只需要保存文件的时候，保存成 UNICODE 编码就可以被其他电脑正常解释。
- UNICODE 在网络传输中，出现了两个标准 UTF-8 和 UTF-16，分别每次传输 8 个位和 16 个位。

于是就会有人产生疑问，UTF-8 既然能保存那么多文字、符号，为什么国内还有这么多使用 GBK 等编码的人？因为 UTF-8 等编码体积比较大，占电脑空间比较多，如果面向的使用人群绝大部分都是中国人，用 GBK 等编码也可以。但是目前的电脑来看，硬盘都是白菜价，电脑性能也已经足够无视这点性能的消耗了。所以推荐所有的网页使用统一编码：UTF-8。

## 如何查看所有的 Unicode 编码？

使用 [Unicode 字符表格][table] 查看即可。比如 `[\u4E00-\u9FA5\uF900-\uFA2D]` 可以匹配所有汉字，可以在表格中查看相应的范围：[#4E00][4e00] - [#9FA5][9fa5]

（完）

## REF

- [网页编码就是那点事][encode], by 潜行者m, 2012/10/22
- [Unicode Character Table][table]
- [js正则表达式之中文验证 - cnblogs][chinese]

[encode]: http://www.qianxingzhem.com/post-1499.html
[table]: https://unicode-table.com/en/
[chinese]: http://www.cnblogs.com/ChengDong/articles/3771880.html
[4e00]: https://unicode-table.com/en/#4E00
[9fa5]: https://unicode-table.com/en/#9FA5
[9fd0]: https://unicode-table.com/en/#9FD0
[fad9]: https://unicode-table.com/en/#FAD9
